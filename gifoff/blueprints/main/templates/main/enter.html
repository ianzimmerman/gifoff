{% extends "layout.html" %}
{% block title %}Enter {{ challenge.name }}{% endblock %}
{% block breadcrumb %}{{ breadcrumbs(group=challenge.group, challenge=challenge, user=current_user.username) }}{% endblock %}
{% block content %}
    <div class="">
        <h1>{{ challenge.name }} <small>authored by {{ challenge.author.username }}</small></h1>
        <h2>Your Entries</h2>
            {% for p in challenge.prompts %}
                <form class="form-group" action="" method="post" id="form{{p.id}}">
                    {{ forms[p.id].hidden_tag() }}
                    <label for="prompt">{{ p.prompt }}</label>
                    <div class="input-group">
                      {{ forms[p.id].url(class="form-control", type="url") }}
                      <span class="input-group-btn">
                        <button id="button{{p.id}}" class="btn btn-primary" type="submit">Save</button>
                      </span>
                    </div>
                    <div id="feedback{{p.id}}" class="form-control-feedback"></div>
                </form>
            {% endfor %}
    </div>
{% endblock %}
{% block scripts %}
<script type="text/javascript">
    $(document).ready(function() {
        $( "form" ).submit(function( event ) {
          
          event.preventDefault();
          
          var form = $(this);
          
          var form_data = form.serialize();
          console.log(form_data);
          
          $.post("{{ url_for('main.enter', challenge_id=challenge) }}", form_data, function (data){
                console.log(data)
                var button = $("#button"+data.prompt_id);
                
                if (data.response == 'OK'){
                    form.removeClass("has-danger");
                    form.addClass("has-success");
                    $("input[name=url]", form).attr('class', 'form-control form-control-success');
                    button.attr('class', 'btn btn-success');
                    button.text('Saved');
                }
                else{
                    form.removeClass("has-success");
                    form.addClass("has-danger");
                    $("input[name=url]", form).attr('class', 'form-control form-control-danger');
                    $("#feedback"+data.prompt_id).text(data.errors.url);
                    button.attr('class', 'btn btn-danger');
                    button.text('Error');
                }
          },'json');
          
        });
    });
</script>
{% endblock %}